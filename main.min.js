var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.once(egret.Event.ADDED_TO_STAGE,e.onAddedToStage,e),e}return __extends(e,t),e.prototype.onAddedToStage=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.width=480,this.textField.height=100,this.textField.x=this.stage.stageWidth/2-this.textField.width/2,this.textField.y=this.stage.stageHeight/2-this.textField.height/2,this.textField.textAlign="center"},e.prototype.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,i){function n(n){e.call(i,n,t)}if(RES.hasRes(t)){var o=RES.getRes(t);o?n(o):RES.getResAsync(t,n,this)}else RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var PacMan;!function(t){var e=function(e){function i(t,i,n){var o=e.call(this)||this;o.collected=!1,o.score=25,o.tileX=t,o.tileY=i,o.scene=n;var r=new egret.MovieClipDataFactory(RES.getRes("crystal_json"),RES.getRes("crystal_png"));return o.movieClipData=r.generateMovieClipData("crystal"),o.gotoAndPlay("hold",-1),o.alignCenter(),o}return __extends(i,e),i.prototype.alignCenter=function(){this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2,this.x=this.tileX*t.TILE_SIZE+t.TILE_SIZE/2,this.y=this.tileY*t.TILE_SIZE+t.TILE_SIZE/2},i.prototype.onCollected=function(){var e=this;this.collected||(t.SoundMgr.getInstance().playSound("ItemDiamond_mp3",1),this.collected=!0,this.gotoAndPlay("end",1),this.alignCenter(),this.addEventListener(egret.Event.LOOP_COMPLETE,function(t){e.parent&&e.parent.removeChild(e)},this),this.parent&&this.scene.playGoldEffect(this.score,this))},i}(egret.MovieClip);t.Crystal=e,__reflect(e.prototype,"PacMan.Crystal")}(PacMan||(PacMan={}));var PacMan;!function(t){var e=function(e){function i(t,i,n){var o=e.call(this)||this;o.tileX=t,o.tileY=i;var r=new egret.MovieClipDataFactory(RES.getRes(n+"_json"),RES.getRes(n+"_png"));return o.movieClipData=r.generateMovieClipData(n),o.play(1),o.alignCenter(),o.addEventListener(egret.Event.COMPLETE,function(t){o.parent.getChildIndex(o)>=0&&o.parent.removeChild(o)},o),o}return __extends(i,e),i.prototype.alignCenter=function(){this.x=this.tileX*t.TILE_SIZE+t.TILE_SIZE/2,this.y=this.tileY*t.TILE_SIZE+t.TILE_SIZE/2},i}(egret.MovieClip);t.Effect=e,__reflect(e.prototype,"PacMan.Effect")}(PacMan||(PacMan={}));var PacMan;!function(t){var e=function(e){function i(t,i,n){var o=e.call(this)||this;return o.score=5,o.tileX=t,o.tileY=i,o.scene=n,o.texture=RES.getRes("coin_png"),o.alignCenter(),o}return __extends(i,e),i.prototype.alignCenter=function(){this.anchorOffsetX=this.texture.textureWidth/2,this.anchorOffsetY=this.texture.textureHeight/2,this.x=this.tileX*t.TILE_SIZE+t.TILE_SIZE/2,this.y=this.tileY*t.TILE_SIZE+t.TILE_SIZE/2},i.prototype.onCollected=function(){t.SoundMgr.getInstance().playSound("ItemGold_mp3",1),this.parent&&(this.scene.playEffect(this.tileX,this.tileY,"gold"),this.scene.playGoldEffect(this.score,this),this.parent.removeChild(this))},i}(egret.Bitmap);t.Gold=e,__reflect(e.prototype,"PacMan.Gold")}(PacMan||(PacMan={}));var PacMan;!function(t){var e=function(e){function i(t,i,n){var o=e.call(this)||this;o.score=1,o.tileX=t,o.tileY=i,o.scene=n;var r=new egret.MovieClipDataFactory(RES.getRes("lightning_json"),RES.getRes("lightning_png"));return o.movieClipData=r.generateMovieClipData("lightning"),o.gotoAndPlay("lightning",-1),o.alignCenter(),o}return __extends(i,e),i.prototype.alignCenter=function(){this.x=this.tileX*t.TILE_SIZE+t.TILE_SIZE/2,this.y=this.tileY*t.TILE_SIZE+t.TILE_SIZE/2},i.prototype.onCollected=function(e){e.onGetLightning(),t.SoundMgr.getInstance().playSound("ItemLighting_mp3",1),this.parent&&(this.scene.playGoldEffect(0,this),this.parent.removeChild(this))},i}(egret.MovieClip);t.Lightning=e,__reflect(e.prototype,"PacMan.Lightning")}(PacMan||(PacMan={}));var PacMan;!function(t){function e(t,e,i,n){var o,r,s,a;i>0?(o=e.x-(t.x+t.w),r=e.x+e.w-t.x):(o=e.x+e.w-t.x,r=e.x-(t.x+t.w)),n>0?(s=e.y-(t.y+t.h),a=e.y+e.h-t.y):(s=e.y+e.h-t.y,a=e.y-(t.y+t.h));var h,l,E,c;0==i?(h=1/0*(o*r>0?1:-1),l=1/0*(o*r>0?-1:1)):(h=o/i,l=r/i),0==n?(E=1/0*(s*a>0?1:-1),c=1/0*(s*a>0?-1:1)):(E=s/n,c=a/n);var p=Math.max(h,E),d=Math.min(l,c);return p>d||0>h&&0>E||h>1||E>1?null:h>E?0>o?{t:p,nx:1,ny:0}:o>0?{t:p,nx:-1,ny:0}:{t:p,nx:i>0?-1:1,ny:0}:0>s?{t:p,nx:0,ny:1}:s>0?{t:p,nx:0,ny:-1}:{t:p,nx:0,ny:n>0?-1:1}}function i(t,i,n,o,r,s){for(var a,h,l=r-n,E=s-o,c={x:n-i.sizeW/2,y:o-i.sizeH/2,w:i.sizeW,h:i.sizeH},p=1/0,d=0,I=t.getObstacles();d<I.length;d++){var g=I[d],u=e(c,g,l,E);u&&u.t<p&&(p=u.t,a=u.nx,h=u.ny)}return{t:p,nx:a,ny:h}}function n(t,e,n,o,r,s){var a=r-n,h=s-o;if(0==a&&0==h)return{x:n,y:o,nx:null,ny:null};var l=i(t,e,n,o,r,s);if(Math.abs(l.t)<1/0){if(n+=l.t*a,o+=l.t*h,0!=l.nx){var E=s-o,c=i(t,e,n,o,n,s);return Math.abs(c.t)<1/0?{x:n,y:o+c.t*E,nx:l.nx,ny:c.ny}:{x:n,y:s,nx:l.nx,ny:l.ny}}var p=r-n,c=i(t,e,n,o,r,o);return Math.abs(c.t)<1/0?{x:n+c.t*p,y:o,nx:c.nx,ny:l.ny}:{x:r,y:o,nx:l.nx,ny:l.ny}}return{x:r,y:s,nx:null,ny:null}}function o(e,i,n,o,r,s){for(var a={x:r-n,y:s-o},h=Math.sqrt(2*a.x+a.y),l=1;h>l;l++){var E={x:l/h*a.x+n,y:l/h*a.y+o};if(this._hhprocMove(e,E)){var c=null,p=({t:c.y+t.TILE_SIZE/2,b:c.y-t.TILE_SIZE/2,l:c.x-t.TILE_SIZE/2,r:c.x+t.TILE_SIZE/2},{x:(l-1)/h*a.x+n,y:(l-1)/h*a.y+o}),d=(p.y-E.y)/(p.x-E.x);p.y-d*p.x,{x:c.x,y:c.y+t.TILE_SIZE/2,w:t.TILE_SIZE,h:1},{x:c.x,y:c.y-t.TILE_SIZE/2,w:t.TILE_SIZE,h:1},{x:c.x-t.TILE_SIZE/2,y:c.y,w:1,h:t.TILE_SIZE},{x:c.x+t.TILE_SIZE/2,y:c.y,w:1,h:t.TILE_SIZE}}}return{x:r,y:s,nx:null,ny:null}}t.rectSweepCollide=e,t.procMove=n,t.hhprocMove=o}(PacMan||(PacMan={}));var Main=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){egret.lifecycle.addLifecycleListener(function(t){t.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},e.prototype.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var e=new eui.Theme("resource/default.thm.json",this.stage);e.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this)},e.prototype.onThemeLoadComplete=function(){RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},e.prototype.onResourceLoadComplete=function(t){"preload"==t.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.createGameScene())},e.prototype.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},e.prototype.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},e.prototype.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},e.prototype.createGameScene=function(){PacMan.SoundMgr.getInstance().init();var t=new PacMan.SceneBattle;this.addChild(t)},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var PacMan;!function(t){var e=500,i=3,n=1,o=3,r=4,s=[new egret.Point(0,-1),new egret.Point(1,0),new egret.Point(0,1),new egret.Point(-1,0)],a=function(a){function h(e,i,o){var r=a.call(this)||this;r.collected=!1,r.state=n,r.curTime=0,r.prevTime=1/0,r.moveDir=s[0],r.moveDis=0,r.killed=!1,r.curAni=null,r.sizeW=t.TILE_SIZE-2,r.sizeH=t.TILE_SIZE-2,r.tileX=e,r.tileY=i,r.scene=o;var h=new egret.MovieClipDataFactory(RES.getRes("monster_json"),RES.getRes("monster_png"));return r.movieClipData=h.generateMovieClipData("monster"),r.gotoAndPlay("walk",-1),r.x=r.tileX*t.TILE_SIZE+t.TILE_SIZE/2,r.y=r.tileY*t.TILE_SIZE+t.TILE_SIZE/2,r.curTime=egret.getTimer(),r.addEventListener(egret.Event.ENTER_FRAME,r.onUpdateFrame,r),r.addEventListener(egret.Event.REMOVED_FROM_STAGE,r.onRemove,r),r.state=n,r.moveDir=s[0],r.moveDis=(Math.floor(1e4*Math.random())%3+1)*t.TILE_SIZE,r}return __extends(h,a),h.prototype.onRemove=function(){this.removeEventListener(egret.Event.ENTER_FRAME,this.onUpdateFrame,this),this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this)},h.prototype.P2T=function(e){return Math.floor(e/t.TILE_SIZE)},h.prototype.onUpdateFrame=function(t){if(!this.killed){var e=egret.getTimer(),s=e-this.prevTime;if(0>s)return void(this.prevTime=e);if(0!=s){this.prevTime=e,this.checkTransfer();var a=this.scene.player;if(!a.isKilled()){if(this.state==n){var h=this.getPlayerDis();if(i>h)return void(a.hasLightning()?this.startEscape():this.startChase());this.onUpdateMove(s)}else if(this.state==o){if(!a.hasLightning())return void this.startChase();this.onUpdateEscape(s)}else if(this.state==r){if(a.hasLightning())return void this.startEscape();this.onUpdateChase(s)}this.updateAnimation()}}}},h.prototype.onUpdateMove=function(i){var n=i/e*t.TILE_SIZE;if(n>0&&this.moveDir){var o=this.moveDir.x*n,r=this.moveDir.y*n,s=t.procMove(this.scene,this,this.x,this.y,this.x+o,this.y+r);this.x=s.x,this.y=s.y,s.nx&&this.onCollided(s.nx<0?3:1),s.ny&&this.onCollided(s.ny<0?0:2),this.moveDis-=n,this.moveDis<=0&&this.onCollided()}},h.prototype.checkTransfer=function(){var e=this.P2T(this.x),i=this.P2T(this.y);if(this.tileX!=e||this.tileY!=i){var o=this.scene.checkTransfer(e,i);o?(this.x=o.x*t.TILE_SIZE+t.TILE_SIZE/2,this.y=o.y*t.TILE_SIZE+t.TILE_SIZE/2,this.tileX=o.x,this.tileY=o.y,this.state==n&&this.startMove()):(this.tileX=e,this.tileY=i)}},h.prototype.startEscape=function(){this.state=o},h.prototype.onUpdateEscape=function(n){var o=this.scene.player;this.moveDir=new egret.Point(this.x-o.x,this.y-o.y),this.moveDir.normalize(1);var r=n/e*t.TILE_SIZE;if(r>0&&this.moveDir){var s=this.moveDir.x*r,a=this.moveDir.y*r,h=t.procMove(this.scene,this,this.x,this.y,this.x+s,this.y+a);this.x=h.x,this.y=h.y}this.getPlayerDis()>i+1&&this.startMove()},h.prototype.startChase=function(){this.state=r},h.prototype.onUpdateChase=function(n){var o=this.scene.player;this.moveDir=new egret.Point(o.x-this.x,o.y-this.y),this.moveDir.normalize(1);var r=n/e*t.TILE_SIZE;if(r>0&&this.moveDir){var s=this.moveDir.x*r,a=this.moveDir.y*r,h=t.procMove(this.scene,this,this.x,this.y,this.x+s,this.y+a);this.x=h.x,this.y=h.y}this.getPlayerDis()>i+1&&this.startMove()},h.prototype.startMove=function(){this.x=this.P2T(this.x)*t.TILE_SIZE+t.TILE_SIZE/2,this.y=this.P2T(this.y)*t.TILE_SIZE+t.TILE_SIZE/2,this.state=n,this.moveDir=s[Math.floor(1e4*Math.random())%4],this.moveDis=Math.floor(1e4*Math.random())%4+3},h.prototype.changeAnimation=function(t,e){void 0===e&&(e=-1),this.curAni!=t&&(this.gotoAndPlay(t,e),this.curAni=t)},h.prototype.updateAnimation=function(){var t=this.scene.player.hasLightning();if(2==t)this.changeAnimation("escape",-1);else if(1==t)this.changeAnimation("change_back",-1);else{var e=180*Math.atan2(this.moveDir.y,this.moveDir.x)/Math.PI;e>-45&&45>e?this.changeAnimation("walk",-1):e>45&&135>e?this.changeAnimation("move_down",-1):e>135||-135>e?this.changeAnimation("walk",-1):-45>e&&e>-135&&this.changeAnimation("move_up",-1)}},h.prototype.onCollided=function(e){if(void 0===e&&(e=null),this.x=this.P2T(this.x)*t.TILE_SIZE+t.TILE_SIZE/2,this.y=this.P2T(this.y)*t.TILE_SIZE+t.TILE_SIZE/2,this.state=n,e){var i=Math.floor(1e4*Math.random())%3;this.moveDir=s[(e+i+1)%4]}else this.moveDir=s[Math.floor(1e4*Math.random())%4];this.moveDis=(Math.floor(1e4*Math.random())%4+3)*t.TILE_SIZE},h.prototype.getPlayerDis=function(){var e=new egret.Point(this.x,this.y),i=this.scene.player,n=new egret.Point(i.x,i.y);return egret.Point.distance(e,n)/t.TILE_SIZE},h.prototype.isKilled=function(){return this.killed},h.prototype.onKilled=function(){var e=this;this.killed=!0,t.SoundMgr.getInstance().playSound("MonsterDie_mp3",1),egret.Tween.removeTweens(this),this.gotoAndPlay("die",1),this.addEventListener(egret.Event.COMPLETE,function(t){e.parent.removeChild(e)},this),this.scene.playMonsterEffect(this)},h}(egret.MovieClip);t.Monster=a,__reflect(a.prototype,"PacMan.Monster")}(PacMan||(PacMan={}));var PacMan;!function(t){var e=250,i=150,n=1,o=function(o){function r(e,i,r){var s=o.call(this)||this;s.state=n,s.prevTime=0,s.curAni=null,s.arrow=new egret.Sprite,s.moveDir=new egret.Point(0,0),s.lightning=null,s.timerLightning=null,s.killed=!1,s.killMonsters=0,s.matchTime=50,s.nowTime=egret.getTimer(),s.sizeW=t.TILE_SIZE-2,s.sizeH=t.TILE_SIZE-2,s.tileX=e,s.tileY=i,s.scene=r,s.restoreGold(),s.restoreKillMonsters(),s.lastTileX=e,s.lastTileY=i;var a=new egret.MovieClipDataFactory(RES.getRes("player_json"),RES.getRes("player_png"));s.movieClip=new egret.MovieClip(a.generateMovieClipData("player")),s.movieClip.gotoAndPlay("walk",-1),s.addChild(s.movieClip),s.x=s.tileX*t.TILE_SIZE+t.TILE_SIZE/2,s.y=s.tileY*t.TILE_SIZE+t.TILE_SIZE/2,s.prevTime=egret.getTimer(),s.addEventListener(egret.Event.ENTER_FRAME,s.onUpdateFrame,s),s.addEventListener(egret.Event.REMOVED_FROM_STAGE,s.onRemove,s);var h=new egret.Bitmap(RES.getRes("ZD_Icon_Jiantou_png"));return h.rotation=270,h.y=s.movieClip.height/2,h.x=s.movieClip.width/2+15,s.arrow.addChild(h),s.addChild(s.arrow),s}return __extends(r,o),r.prototype.addKillMonsters=function(t){return this.killMonsters+=t,this.killMonsters},r.prototype.restoreKillMonsters=function(){this.killMonsters=0},r.prototype.addGolds=function(t){this.gold+=t,this.scene&&this.scene.topGold&&this.scene.topGold.$setText(this.gold)},r.prototype.restoreGold=function(){this.gold=0,this.addGolds(0)},r.prototype.onRemove=function(){this.removeEventListener(egret.Event.ENTER_FRAME,this.onUpdateFrame,this),this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this)},r.prototype.P2T=function(e){return Math.floor(e/t.TILE_SIZE)},r.prototype.onUpdateFrame=function(n){if(!this.killed){var o=egret.getTimer(),r=o-this.prevTime;if(0>r)return void(this.prevTime=o);if(0!=r){this.scene.checkSeriesEffect(),this.prevTime=o;var s=r/(this.lightning?i:e)*t.TILE_SIZE;if(s>0&&this.moveDir){var a=this.moveDir.x*s,h=this.moveDir.y*s;this.onUpdateMove(a,h);var l=this.P2T(this.x),E=this.P2T(this.y);if(this.scene.checkItemCollision(this,l,E),this.lastTileX!=l||this.lastTileY!=E){var c=this.scene.checkTransfer(l,E);c?(this.x=c.x*t.TILE_SIZE+t.TILE_SIZE/2,this.y=c.y*t.TILE_SIZE+t.TILE_SIZE/2,this.lastTileX=c.x,this.lastTileY=c.y):(this.lastTileX=l,this.lastTileY=E)}else this.lastTileX=l,this.lastTileY=E}this.scene.checkMonsterCollision(this)}}},r.prototype.onUpdateMove=function(e,i){var n=t.procMove(this.scene,this,this.x,this.y,this.x+e,this.y+i);this.x=n.x,this.y=n.y},r.prototype.onChangeMoveDir=function(t){if(!this.killed&&(!this.moveDir&&t&&(this.prevTime=egret.getTimer()),this.moveDir=t,t)){var e=180*Math.atan2(t.y,t.x)/Math.PI;this.arrow.rotation=e,e>-45&&45>e?this.changeAnimation(this.lightning?"run":"walk"):e>45&&135>e?this.changeAnimation(this.lightning?"run_down":"move_down"):e>135||-135>e?this.changeAnimation(this.lightning?"run":"walk"):-45>e&&e>-135&&this.changeAnimation(this.lightning?"run_up":"move_up")}},r.prototype.changeAnimation=function(t,e){void 0===e&&(e=-1),this.curAni!=t&&(this.movieClip.gotoAndPlay(t,e),this.curAni=t)},r.prototype.onChangeAniForLightning=function(){this.moveDir?this.onChangeMoveDir(this.moveDir):this.changeAnimation("run")},r.prototype.onGetLightning=function(){var t=this;this.lightning=2;var e="speed_fire",i=new egret.MovieClipDataFactory(RES.getRes(e+"_json"),RES.getRes(e+"_png")),n=new egret.MovieClip(i.generateMovieClipData(e));n.play(1),this.addChild(n),n.addEventListener(egret.Event.COMPLETE,function(e){t.getChildIndex(n)>=0&&t.removeChild(n)},this),this.onChangeAniForLightning(),this.scene.updateAllMonsterAnimation(),this.timerLightning&&egret.clearTimeout(this.timerLightning),this.timerLightning=egret.setTimeout(function(){this.lightning=1,this.scene.updateAllMonsterAnimation(),this.timerLightning=egret.setTimeout(function(){this.lightning=null,this.timerLightning=null,this.onChangeAniForLightning(),this.scene.updateAllMonsterAnimation()},this,1e3)},this,4e3)},r.prototype.hasLightning=function(){return this.lightning},r.prototype.isKilled=function(){return this.killed},r.prototype.onKilled=function(){var e=this;this.killed=!0,this.changeAnimation("die",1),t.SoundMgr.getInstance().playSound("PlayerDie_mp3",1),this.arrow.visible=!1,this.movieClip.addEventListener(egret.Event.COMPLETE,function(t){e.parent.removeChild(e),e.scene.showClear(),e.restoreGold(),e.restoreKillMonsters()},this)},r}(egret.Sprite);t.Player=o,__reflect(o.prototype,"PacMan.Player")}(PacMan||(PacMan={}));var PacMan;!function(t){t.TILE_NONE=0,t.TILE_BLOCK=1,t.TILE_TRANSFER=2,t.TILE_MONSTER_BORN=3,t.TILE_PLAYER_BORN=-1,t.ITEM_GOLD=1,t.ITEM_CRYSTAL=2,t.ITEM_LIGHTNING=3,t.TILE_SIZE=57,t.SERIES_GOLD_MAX_TIME=500,t.SERIES_GOLD_MIN_NUMBER=5,t.SERIES_GOLD_MAX_NUMBER=20,t.SERIES_GOLD_ANI_TIME=600,t.BITMAP_HEIGHT=42,t.MONSTER_GOLD=25,t.COMMON_GOLD=5,t.BLUE_GOLD=25,t.TOP_GOLD_COLOR=15790090;var e=function(e){function i(){var i=e.call(this)||this;return i.LevelData=[[1,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,1,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,1,0,0,0,0,0,0,0,1,0,1],[1,0,0,0,0,-3,3,-3,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,1,1,1,0,0,0,0,1],[1,0,0,1,0,0,-1,0,0,1,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,1,0,0,0,1,0,0,0,1,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,1,0,0,0,0,0,1],[1,0,1,0,0,0,0,0,0,0,1,0,1],[2,0,1,0,0,0,0,0,0,0,1,0,2],[1,0,1,0,0,0,0,0,0,0,1,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,1]],i.obstacles=[{x:-t.TILE_SIZE,y:0,w:t.TILE_SIZE,h:20*t.TILE_SIZE},{x:13*t.TILE_SIZE,y:0,w:t.TILE_SIZE,h:20*t.TILE_SIZE},{x:0,y:-5,w:t.TILE_SIZE,h:17*t.TILE_SIZE},{x:12*t.TILE_SIZE,y:-5,w:t.TILE_SIZE,h:17*t.TILE_SIZE},{x:0,y:18*t.TILE_SIZE+5,w:t.TILE_SIZE,h:2*t.TILE_SIZE},{x:12*t.TILE_SIZE,y:18*t.TILE_SIZE+5,w:t.TILE_SIZE,h:2*t.TILE_SIZE},{x:0,y:-t.TILE_SIZE,w:t.TILE_SIZE*t.TILE_SIZE*13,h:t.TILE_SIZE},{x:0,y:20*t.TILE_SIZE,w:t.TILE_SIZE*t.TILE_SIZE*13,h:t.TILE_SIZE},{x:6*t.TILE_SIZE,y:4*t.TILE_SIZE,w:t.TILE_SIZE,h:t.TILE_SIZE},{x:6*t.TILE_SIZE,y:4*t.TILE_SIZE,w:t.TILE_SIZE,h:t.TILE_SIZE},{x:5*t.TILE_SIZE,y:8*t.TILE_SIZE,w:t.TILE_SIZE,h:t.TILE_SIZE},{x:7*t.TILE_SIZE,y:8*t.TILE_SIZE,w:t.TILE_SIZE,h:t.TILE_SIZE},{x:2*t.TILE_SIZE,y:7*t.TILE_SIZE,w:t.TILE_SIZE,h:t.TILE_SIZE},{x:10*t.TILE_SIZE,y:7*t.TILE_SIZE,w:t.TILE_SIZE,h:t.TILE_SIZE},{x:5*t.TILE_SIZE,y:10*t.TILE_SIZE+5,w:3*t.TILE_SIZE,h:t.TILE_SIZE-5},{x:3*t.TILE_SIZE,y:11*t.TILE_SIZE,w:t.TILE_SIZE,h:t.TILE_SIZE},{x:9*t.TILE_SIZE,y:11*t.TILE_SIZE,w:t.TILE_SIZE,h:t.TILE_SIZE},{x:2*t.TILE_SIZE,y:13*t.TILE_SIZE,w:t.TILE_SIZE,h:t.TILE_SIZE},{x:6*t.TILE_SIZE,y:13*t.TILE_SIZE,w:t.TILE_SIZE,h:t.TILE_SIZE-5},{x:10*t.TILE_SIZE,y:13*t.TILE_SIZE,w:t.TILE_SIZE,h:t.TILE_SIZE},{x:6*t.TILE_SIZE,y:15*t.TILE_SIZE+5,w:t.TILE_SIZE,h:t.TILE_SIZE-5},{x:2*t.TILE_SIZE,y:16*t.TILE_SIZE,w:t.TILE_SIZE,h:3*t.TILE_SIZE},{x:10*t.TILE_SIZE,y:16*t.TILE_SIZE,w:t.TILE_SIZE,h:3*t.TILE_SIZE}],i.TileMap=(n={},n[1]={type:"png",png:"MapBlock_png"},n[2]={type:"mc",mc:"transfer"},n[3]={type:"png",png:"MapMonsterHouse_png",oft_x:-1},n),i.mapItems={},i.maxCrystal=10,i.maxLightning=4,i.bornPosMonster={x:0,y:0},i.bornPosPlayer={x:0,y:0},i.transfers={},i.monsters={},i.timerMonsterReborn=null,i.timerGame=null,i.touchBeginPos=null,i.lastTouchStop=egret.getTimer(),i.player=null,i.activeGold=0,i.lastEatGold={time:egret.getTimer(),lastItem:null},i.aniNumbers=0,i.skinName="resource/eui_skins/ui_battle.exml",i.once(egret.Event.ADDED_TO_STAGE,i.onAddedToStage,i),i.UP.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){this.player.moveDir.y=-1,this.player.onChangeMoveDir(this.player.moveDir)},i),i.UP.addEventListener(egret.TouchEvent.TOUCH_END,function(){this.player.moveDir.y=0,this.player.onChangeMoveDir(this.player.moveDir)},i),i.DOWN.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){this.player.moveDir.y=1,this.player.onChangeMoveDir(this.player.moveDir)},i),i.DOWN.addEventListener(egret.TouchEvent.TOUCH_END,function(){this.player.moveDir.y=0,this.player.onChangeMoveDir(this.player.moveDir)},i),i.LEFT.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){this.player.moveDir.x=-1,this.player.onChangeMoveDir(this.player.moveDir)},i),i.LEFT.addEventListener(egret.TouchEvent.TOUCH_END,function(){this.player.moveDir.x=0,this.player.onChangeMoveDir(this.player.moveDir)},i),i.RIGHT.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){this.player.moveDir.x=1,this.player.onChangeMoveDir(this.player.moveDir)},i),i.RIGHT.addEventListener(egret.TouchEvent.TOUCH_END,function(){this.player.moveDir.x=0,this.player.onChangeMoveDir(this.player.moveDir)},i),i;var n}return __extends(i,e),i.prototype.getLevelData=function(){return this.LevelData},i.prototype.getObstacles=function(){return this.obstacles},i.prototype.onTouchBegin=function(t){this.touchBeginPos=new egret.Point(t.localX,t.localY)},i.prototype.onTouchMove=function(t){if(this.touchBeginPos&&this.player){var e=t.localX-this.touchBeginPos.x,i=t.localY-this.touchBeginPos.y;if(!(Math.abs(e)<30&&Math.abs(i)<30)){var n=new egret.Point(e,i);n.normalize(1),this.player.onChangeMoveDir(n),this.touchBeginPos.x=t.localX,this.touchBeginPos.y=t.localY}}},i.prototype.onTouchEnd=function(){this.touchBeginPos=null,this.player&&this.player.onChangeMoveDir(null)},i.prototype.onAddedToStage=function(){this.restartGame()},i.prototype.loadLevel=function(){for(var e=[],i=0;i<this.LevelData.length;++i)for(var n=this.LevelData[i],o=0;o<n.length;++o){var r=n[o];this.addTile(o,i,r),r==t.TILE_MONSTER_BORN?this.bornPosMonster={x:o,y:i}:r==t.TILE_PLAYER_BORN?this.bornPosPlayer={x:o,y:i}:r==t.TILE_TRANSFER&&e.push({x:o,y:i})}if(2==e.length){var s=e[0],a=e[1];this.transfers[this.encodeCoord(s.x,s.y)]=a,this.transfers[this.encodeCoord(a.x,a.y)]=s}},i.prototype.addTile=function(e,i,n){if(n>0){var o=this.TileMap[n];if(!o)return;var r=void 0;if("png"==o.type)r=new egret.Bitmap(RES.getRes(o.png)),o.oft_x&&(e+=o.oft_x),o.oft_y&&(i+=o.oft_y);else if("mc"==o.type){var s=new egret.MovieClipDataFactory(RES.getRes(o.mc+"_json"),RES.getRes(o.mc+"_png"));r=new egret.MovieClip(s.generateMovieClipData(o.mc)),r.play(-1)}r&&(this.groupMap.addChild(r),r.x=e*t.TILE_SIZE,r.y=i*t.TILE_SIZE)}},i.prototype.encodeCoord=function(t,e){return 1e4*e+t},i.prototype.decodeCoord=function(t){return{x:Math.floor(t%1e4),y:Math.floor(t/1e4)}},i.prototype.genItems=function(){for(var e=[],i=0;i<this.LevelData.length;++i)for(var n=this.LevelData[i],o=0;o<n.length;++o){var r=n[o];0==r&&e.push({x:o,y:i,id:t.ITEM_GOLD})}if(e.length>0){for(var s=1;s<e.length;++s){var a=Math.floor(1e4*Math.random())%(e.length-s),h=e[a];e[a]=e[e.length-s],e[e.length-s]=h}for(var s=0;s<this.maxCrystal&&s<e.length;++s)e[s].id=t.ITEM_CRYSTAL;for(;s<this.maxCrystal+this.maxLightning&&s<e.length;++s)e[s].id=t.ITEM_LIGHTNING;for(var l=0,E=e;l<E.length;l++){var c=E[l];this.mapItems[this.encodeCoord(c.x,c.y)]={id:c.id}}}for(var p in this.mapItems){var d=this.decodeCoord(p),I=this.mapItems[p];this.addItem(d.x,d.y,I)}},i.prototype.addItem=function(e,i,n){if(n.id==t.ITEM_GOLD){var o=new t.Gold(e,i,this);this.groupMap.addChild(o),n.obj=o}else if(n.id==t.ITEM_CRYSTAL){var r=new t.Crystal(e,i,this);this.groupMap.addChild(r),n.obj=r}else if(n.id==t.ITEM_LIGHTNING){var s=new t.Lightning(e,i,this);this.groupMap.addChild(s),n.obj=s}},i.prototype.genMonsters=function(){for(var e=0;8>e;++e){var i=new t.Monster(this.bornPosMonster.x,this.bornPosMonster.y,this);this.groupMap.addChild(i),this.monsters[e]=i}},i.prototype.genPlayer=function(){var e=new t.Player(this.bornPosPlayer.x,this.bornPosPlayer.y,this);this.groupPlayer.addChild(e),this.player=e},i.prototype.canMove=function(t,e){var i=this.LevelData[e];return i?0==i[t]||2==i[t]||-1==i[t]:!1},i.prototype.checkItemCollision=function(t,e,i){var n=this.encodeCoord(e,i),o=this.mapItems[n];o&&(o.obj.onCollected(t),delete this.mapItems[n])},i.prototype.checkTransfer=function(e,i){var n=this.encodeCoord(e,i),o=this.transfers[n];return o?(this.playEffect(e,i,"transfer_fire"),this.playEffect(o.x,o.y,"transfer_fire"),t.SoundMgr.getInstance().playSound("MapTeleporter_mp3",1),o):null},i.prototype.playEffect=function(e,i,n){var o=new t.Effect(e,i,n);this.groupMap.addChild(o)},i.prototype.playGoldEffect=function(e,i){e||(e=0),this.player.addGolds(e),this.lastEatGold.time=egret.getTimer(),this.lastEatGold.lastItem=i,this.activeGold++;var n=new eui.Label(this.activeGold.toString());n.x=i.x,n.y=i.y,n.anchorOffsetX=n.width/2,n.anchorOffsetY=n.height/2,this.groupMap.addChild(n),this.activeGold>=t.SERIES_GOLD_MIN_NUMBER?(n.textColor=t.TOP_GOLD_COLOR,this.activeGold>=t.SERIES_GOLD_MAX_NUMBER&&this.playEffect(i.tileX,i.tileY,"combo_hit"),egret.Tween.get(n).to({scaleX:2,scaleY:2},50).to({scaleX:1,scaleY:1},150).wait(200).to({alpha:0},300).call(function(){this.groupMap.getChildIndex(n)>=0&&this.groupMap.removeChild(n)},this)):egret.Tween.get(n).wait(500).to({alpha:0},300).call(function(){this.groupMap.getChildIndex(n)>=0&&this.groupMap.removeChild(n)},this)},i.prototype.playMonsterEffect=function(e){setTimeout(function(){var i=this.player.addKillMonsters(1),n=t.MONSTER_GOLD*i;this.player.addGolds(n),this.creatGoldAni(e,i+"s","o+"+n,this.topGold)}.bind(this),this.aniNumbers++*t.SERIES_GOLD_ANI_TIME)},i.prototype.checkSeriesEffect=function(){egret.getTimer()-this.lastEatGold.time>t.SERIES_GOLD_MAX_TIME&&(this.activeGold>=t.SERIES_GOLD_MIN_NUMBER&&(this.player.addGolds(this.activeGold),this.creatGoldAni(this.lastEatGold.lastItem,this.activeGold+"l","o+"+this.activeGold,this.topGold)),this.activeGold=0,this.lastEatGold.lastItem=null)},i.prototype.creatGoldAni=function(e,i,n,o){if(o&&e){t.SoundMgr.getInstance().playSound("ItemBonus_mp3",1);var r=e.localToGlobal();r=this.groupGoldAni.globalToLocal(r.x,r.y);var s=new eui.Group;e.score?s.anchorOffsetY=-t.TILE_SIZE:s.anchorOffsetX=-t.TILE_SIZE/2,s.x=r.x,s.y=r.y;var a=new eui.BitmapLabel(i);a.font=RES.getRes("font_fnt"),a.x=0,a.y=0,a.height=t.BITMAP_HEIGHT;var h=new eui.BitmapLabel(n);h.font=RES.getRes("font_coin_fnt"),h.x=a.x,h.y=a.y+t.BITMAP_HEIGHT+10,s.addChild(a),s.addChild(h),this.groupGoldAni.addChild(s),egret.Tween.get(s).wait(500).call(function(){},this).to({x:o.x,y:o.y},t.SERIES_GOLD_ANI_TIME).to({alpha:0},250).call(function(){this.aniNumbers--,this.groupGoldAni.getChildIndex(s)>=0&&this.groupGoldAni.removeChild(s)},this)}},i.prototype.checkMonsterCollision=function(e){var i=[];for(var n in this.monsters){var o=this.monsters[n];if(!o.isKilled()){var r=Math.abs(e.x-o.x),s=Math.abs(e.y-o.y);r>t.TILE_SIZE/2||s>t.TILE_SIZE/2||i.push(n)}}if(0!=i.length)if(e.hasLightning()){for(var a=0,h=i;a<h.length;a++){var l=h[a],o=this.monsters[l];o.onKilled(),delete this.monsters[l]}this.checkMonsterReborn()}else e.onKilled()},i.prototype.checkMonsterReborn=function(){for(var t in this.monsters)return;this.timerMonsterReborn&&egret.clearTimeout(this.timerMonsterReborn),this.timerMonsterReborn=egret.setTimeout(function(){this.genMonsters()},this,2e3)},i.prototype.setTimer=function(e){e=Math.floor(e);var i=Math.floor(e/60),n=e%60;this.labelTimer.text=(10>i?"0":"")+i+":"+(10>n?"0":"")+n,e>0?(this.timerGame&&egret.clearTimeout(this.timerGame),this.timerGame=egret.setTimeout(function(){this.setTimer(e-1)},this,1e3),10>e&&t.SoundMgr.getInstance().playSound("CountDownEff_mp3",1)):this.showClear()},i.prototype.restartGame=function(){this.activeGold=0,this.lastEatGold.lastItem=null,this.lastEatGold.time=egret.getTimer(),this.groupGoldAni.removeChildren(),this.groupMap.removeChildren(),this.groupPlayer.removeChildren(),this.mapItems={},this.bornPosMonster={x:0,y:0},this.bornPosPlayer={x:0,y:0},this.transfers={},this.monsters={},this.touchBeginPos=null,this.lastTouchStop=egret.getTimer(),this.player=null,this.setTimer(60),this.loadLevel(),this.genItems(),this.genPlayer(),this.timerMonsterReborn&&egret.clearTimeout(this.timerMonsterReborn),this.timerMonsterReborn=egret.setTimeout(function(){this.genMonsters()},this,2e3)},i.prototype.showClear=function(){var t=new eui.Image(RES.getRes("Transition02_png"));t.width=this.stage.stageWidth+400,t.height=this.stage.stageHeight,this.addChild(t),t.x=this.stage.stageWidth,egret.Tween.get(t).to({x:-400},500).call(function(){this.restartGame(),this.removeChild(t)},this)},i.prototype.updateAllMonsterAnimation=function(){for(var t in this.monsters){var e=this.monsters[t];e.updateAnimation()}},i}(eui.Component);t.SceneBattle=e,__reflect(e.prototype,"PacMan.SceneBattle")}(PacMan||(PacMan={}));var PacMan;!function(t){var e=function(){function t(){this.soundList={}}return t.getInstance=function(){return null==t.instance&&(t.instance=new t),t.instance},t.prototype.init=function(){var t=this,e=new egret.Sound,i=function(){e.removeEventListener(egret.Event.COMPLETE,i,this),window.PlaySound(egret.Capabilities.os,e,1),t.loadAllSound()};e.addEventListener(egret.Event.COMPLETE,i,this),e.load("resource/assets/afx/NullSound.mp3")},t.prototype.loadAllSound=function(){var t=this,e=function(e){var i=new egret.Sound,n=function(){i.removeEventListener(egret.Event.COMPLETE,n,this),t.soundList[e+"_mp3"]=i,"GameBg"==e&&i.play(0,-1)};i.addEventListener(egret.Event.COMPLETE,n,this),i.load("resource/assets/afx/"+e+".mp3")};e("BtnEff"),e("CountDownEff"),e("GameOver"),e("ItemBonus"),e("ItemDiamond"),e("ItemGold"),e("ItemLighting"),e("MapTeleporter"),e("MonsterDie"),e("NextLevel"),e("PlayerDie"),e("GameBg")},t.prototype.loadSound=function(t){this.soundList[t]=RES.getRes(t)},t.prototype.playSound=function(t,e){var i=this.soundList[t];return i?i.play(0,e):null},t.instance=null,t}();t.SoundMgr=e,__reflect(e.prototype,"PacMan.SoundMgr")}(PacMan||(PacMan={}));var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,i,n){function o(t){e.call(n,t)}function r(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),i.call(n))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),RES.getResByUrl(t,o,this,RES.ResourceItem.TYPE_TEXT)},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);